---
title: MongoDBì™€ ì§€ë¦¬ê²€ìƒ‰ 
layout: post
tag: [mongodb]
toc: true
---

[ë°°ë‹¬ì•±ì€ ì–´ë–»ê²Œ ë‚´ ì£¼ë³€ì˜ ë§›ì§‘ì„ ì°¾ì„ê¹Œ?](https://inf.run/3BEWe) íŒŒíŠ¸1ì— ëŒ€í•œ ê°œì¸ì ì¸ ì •ë¦¬ ê¸€ ìž…ë‹ˆë‹¤.

## MongoDBì—ì„œ ì§€ë¦¬ê³µê°„ ë°ì´í„° ë‹¤ë£¨ëŠ” ë°©ë²•

MongoDBëŠ” ë‹¤ì–‘í•œ í˜•íƒœì˜ ë°ì´í„°ë¥¼ ì €ìž¥í•˜ê³  ê²€ìƒ‰í•  ìˆ˜ ìžˆëŠ” ìœ ì—°ì„±ì„ ì œê³µí•˜ë©°, ì§€ë¦¬ê³µê°„ ë°ì´í„°ì˜ ì²˜ë¦¬ë„ ì˜ˆì™¸ëŠ” ì•„ë‹™ë‹ˆë‹¤. MongoDBì—ì„œ ì§€ë¦¬ê³µê°„ ë°ì´í„°ë¥¼ ë‹¤ë£¨ê¸° ìœ„í•´, ì²« ë²ˆì§¸ ë‹¨ê³„ëŠ” ì ì ˆí•œ ì¸ë±ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ê²ƒìž…ë‹ˆë‹¤. ì§€ë¦¬ê³µê°„ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•˜ë©´, íš¨ìœ¨ì ìœ¼ë¡œ ìœ„ì¹˜ ê¸°ë°˜ ë°ì´í„°ë¥¼ ì¿¼ë¦¬í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

### ì¸ë±ìŠ¤ 
[MongoDB Geospatial Indexes](https://www.mongodb.com/docs/manual/core/indexes/index-types/index-geospatial/)   

MongoDBì—ì„œ ì œê³µí•˜ëŠ” ì§€ë¦¬ê³µê°„ ì¸ë±ìŠ¤ ìœ í˜•ì€ 2dsphereì™€ 2dê°€ ìžˆìŠµë‹ˆë‹¤. 
#### 2dsphere 
* ê°œë…: 2dsphere ì¸ë±ìŠ¤ëŠ” ì§€êµ¬ì™€ ê°™ì€ êµ¬í˜• ëª¨ë¸ì„ ê¸°ë°˜ìœ¼ë¡œ ê³µê°„ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì´ ìœ í˜•ì˜ ì¸ë±ìŠ¤ëŠ” ì§€ë¦¬ì  ìœ„ì¹˜ ë°ì´í„°ë¥¼ ìœ„í•´ ì„¤ê³„ë˜ì—ˆìœ¼ë©°, ìœ„ë„ì™€ ê²½ë„ë¥¼ ì‚¬ìš©í•˜ëŠ” ì¢Œí‘œê³„ì—ì„œ íš¨ê³¼ì ìž…ë‹ˆë‹¤.
* ì‚¬ìš© ì‚¬ë¡€: 2dsphere ì¸ë±ìŠ¤ëŠ” ì–´ë– í•œ í˜•íƒœì˜ ì§€ë¦¬ê³µê°„ ê°ì²´(í¬ì¸íŠ¸, ë¼ì¸, í´ë¦¬ê³¤)ë„ ì§€ì›í•˜ë©°, ì´ë¥¼ ì´ìš©í•´ ê±°ë¦¬ ì¸¡ì •, ë©´ì  ì°¾ê¸°, ê²½ê³„ ë‚´/ê²½ê³„ êµì°¨ ë“±ì˜ ë³µìž¡í•œ ê³µê°„ ì¿¼ë¦¬ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.
* ìž¥ì : ì‹¤ì œ ì§€êµ¬ì™€ ê°™ì€ êµ¬ë©´ ì¢Œí‘œê³„ì— ìµœì í™”ë˜ì–´ ìžˆì–´ ì •í™•í•˜ê³  ë³µìž¡í•œ ì§€ë¦¬ê³µê°„ ì¿¼ë¦¬ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

#### 2d
* ê°œë…: 2d ì¸ë±ìŠ¤ëŠ” í‰ë©´ì ì¸ ì¢Œí‘œê³„ë¥¼ ì‚¬ìš©í•˜ì—¬ ê³µê°„ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤. ì£¼ë¡œ ê°„ë‹¨í•œ í‰ë©´ ì§€ë„ ë˜ëŠ” ì¹´í…Œì‹œì•ˆ í‰ë©´ ìœ„ì˜ ë°ì´í„°ì— ì‚¬ìš©ë©ë‹ˆë‹¤.
* ì‚¬ìš© ì‚¬ë¡€: ì´ ì¸ë±ìŠ¤ëŠ” ì£¼ë¡œ ê°„ë‹¨í•œ 2ì°¨ì› ìœ„ì¹˜ ê²€ìƒ‰ì— ì‚¬ìš©ë˜ë©°, Xì™€ Y ì¢Œí‘œë¥¼ ì‚¬ìš©í•˜ëŠ” ë°ì´í„°ì— ì í•©í•©ë‹ˆë‹¤. ê±°ë¦¬ ì¸¡ì • ë° ì§ì‚¬ê°í˜• ë²”ìœ„ ë‚´ì˜ ê°ì²´ë¥¼ ì°¾ëŠ” ë° ì£¼ë¡œ í™œìš©ë©ë‹ˆë‹¤.
* ìž¥ì : 2d ì¸ë±ìŠ¤ëŠ” í‰ë©´ ë°ì´í„°ì— ëŒ€í•œ ê°„ë‹¨í•˜ê³  ë¹ ë¥¸ ì¿¼ë¦¬ ìˆ˜í–‰ì´ ê°€ëŠ¥í•˜ë©°, ì£¼ë¡œ ê°„ë‹¨í•œ ê±°ë¦¬ ì¸¡ì •ê³¼ ë²”ìœ„ ì¿¼ë¦¬ì— ìœ ìš©í•©ë‹ˆë‹¤.

#### ì°¨ì´ì 
* ì¢Œí‘œê³„ : 2dsphereëŠ” êµ¬í˜• ì¢Œí‘œê³„ë¥¼, 2dëŠ” í‰ë©´ ì¢Œí‘œê³„ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.
* ì§€ì›í•˜ëŠ” ë°ì´í„° ìœ í˜• : 2dsphereëŠ” ë‹¤ì–‘í•œ ì§€ë¦¬ê³µê°„ ë°ì´í„° ìœ í˜•(í¬ì¸íŠ¸, ë¼ì¸, í´ë¦¬ê³¤ ë“±)ì„ ì§€ì›í•˜ëŠ” ë°˜ë©´, 2dëŠ” ì£¼ë¡œ 2ì°¨ì› í¬ì¸íŠ¸ì— ìµœì í™”ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.
* ì ìš© ê°€ëŠ¥í•œ ì¿¼ë¦¬ ìœ í˜• : 2dsphereëŠ” ë³´ë‹¤ ë³µìž¡í•˜ê³  ë‹¤ì–‘í•œ ì§€ë¦¬ê³µê°„ ì¿¼ë¦¬ë¥¼ ì§€ì›í•˜ì§€ë§Œ, 2dëŠ” ê°„ë‹¨í•œ 2ì°¨ì› ë²”ìœ„ì™€ ê±°ë¦¬ ì¸¡ì •ì— ì´ˆì ì„ ë§žì¶¥ë‹ˆë‹¤.


### ë°ì´í„° íƒ€ìž…
MongoDBëŠ” Pointì™€ Polygonì„ í¬í•¨í•œ ì—¬ëŸ¬ ì§€ë¦¬ê³µê°„ ë°ì´í„° í˜•ì‹ì„ ì§€ì›í•©ë‹ˆë‹¤. PointëŠ” ë‹¨ì¼ ìœ„ì¹˜ë¥¼ ë‚˜íƒ€ë‚´ë©°, Polygonì€ ë‹¤ê°í˜• ì˜ì—­ì„ í‘œí˜„í•©ë‹ˆë‹¤. 

#### Point
PointëŠ” ìœ„ë„ì™€ ê²½ë„ë¥¼ í•˜ë‚˜ë¡œ ë¬¶ì€ ìžë£Œêµ¬ì¡°ìž…ë‹ˆë‹¤. MongoDBì—ì„œëŠ” geo json ì–‘ì‹ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. 
![image](https://github.com/hobit22/hobit22.github.io/assets/40729223/eb7145ef-e76c-47d2-a01e-15f528c3fb2f)
```json
{
  "type": "Point",
  "coordinates": [127.027667, 37.498563]
}
```
longitude, latitude ìˆœì„œ

Point ë°ì´í„°ë¥¼ í™œìš©í•œ ê²€ìƒ‰ì€ ìœ„ì¹˜ ê¸°ë°˜ ì„œë¹„ìŠ¤ì—ì„œ ë§¤ìš° í”í•˜ê²Œ ì‚¬ìš©ë©ë‹ˆë‹¤. ì‚¬ìš©ìžì˜ í˜„ìž¬ ìœ„ì¹˜ì—ì„œ ê°€ìž¥ ê°€ê¹Œìš´ ë§¤ìž¥ì„ ì°¾ê±°ë‚˜, íŠ¹ì • ë²”ìœ„ ë‚´ì˜ ê´€ì‹¬ ì§€ì (POI)ì„ ì¡°íšŒí•˜ëŠ” ê²ƒì´ ì˜ˆìž…ë‹ˆë‹¤.

#### Polygon
`point` ì ë“¤ì´ ëª¨ì¸ ì„  `linestring`ì´ê³ ,  `linestring` ì„ ë“¤ì´ ëª¨ì¸ ë©´ì´ `polygon` ìž…ë‹ˆë‹¤.
![image](https://github.com/hobit22/hobit22.github.io/assets/40729223/473ed59f-3348-4e19-a22d-d19c8815c8e2)
```json
{
  "type": "Polygon",
  "coordinates": [
    [[0,0], [0,2], [2,2], [2,0], [0,0]],
    [[1,0], [1.5,0.5], [1,1], [0.5,0.5], [1,0]]
  ]
}
```

> ##### ðŸ’¡ Right Hand Rule
`polygon`ì„ ê·¸ë¦´ ë•ŒëŠ”, ê²‰ ë¶€ë¶„ì€ ì‹œê³„ë°©í–¥ìœ¼ë¡œ ì•ˆìª½ ë¶€ë¶„ì€ ë°˜ì‹œê³„ ë°©í–¥ìœ¼ë¡œ ê·¸ë ¤ì•¼ í•˜ëŠ” ê·œì¹™ì´ ìžˆë‹¤.

Polygonì„ ì‚¬ìš©í•œ ê²€ìƒ‰ì€ ì‚¬ìš©ìžê°€ ì •ì˜í•œ íŠ¹ì • ì§€ì—­ ë‚´ì˜ ë°ì´í„°ë¥¼ ì°¾ëŠ” ë° ì‚¬ìš©ë©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, íŠ¹ì • ì§€ì—­ ë‚´ì˜ ì´ë²¤íŠ¸ë‚˜ ê´‘ê³ ë¥¼ ì°¾ê¸° ìœ„í•´ ì‚¬ìš©í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.

$geoWithinê³¼ $geoIntersects ì—°ì‚°ìžë¥¼ ì‚¬ìš©í•˜ì—¬ Polygon ë‚´ë¶€ ë˜ëŠ” êµì°¨í•˜ëŠ” ìœ„ì¹˜ì˜ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤.





### Google S2

[S2 ê³µì‹ë¬¸ì„œ](https://s2geometry.io/)

![image](https://github.com/hobit22/hobit22.github.io/assets/40729223/985655e8-9082-4f37-9d53-c3bfbd7242e9)


Google S2 ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì§€êµ¬ë¥¼ ì…€ë¡œ ë‚˜ëˆ„ì–´ ê³µê°„ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ìƒ‰ì¸í•˜ê³  ê²€ìƒ‰í•  ìˆ˜ ìžˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤. ì´ ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” ì§€ë¦¬ê³µê°„ ê²€ìƒ‰ì—ì„œ ê³ ìœ í•œ ì ‘ê·¼ ë°©ì‹ì„ ì‚¬ìš©í•˜ì—¬, ì§€êµ¬ í‘œë©´ì„ êµ¬í˜• íŠ¸ë¦¬ë¡œ ë‚˜íƒ€ë‚´ë©°, ì´ëŠ” S2 ì…€ì´ë¼ê³  ë¶ˆë¦¬ëŠ” ìž‘ì€ ì˜ì—­ìœ¼ë¡œ ë¶„í• ë©ë‹ˆë‹¤. 

| Google s2 ë¥¼ í•œ ë§ˆë””ë¡œ ë§í•˜ìžë©´ ë™ê·¸ëž€ ì§€êµ¬ í‘œë©´ ìœ„ì— ížë²„íŠ¸ ì»¤ë¸Œë¥¼ ê·¸ë ¤ë†“ì€ ê²ƒ

![image](https://github.com/hobit22/hobit22.github.io/assets/40729223/d7a87b81-d1f0-481f-9709-14e331cbc504)


S2 ì¸ë±ìŠ¤ ìƒì„± ì „ Query Performance Summary 
![image](https://github.com/hobit22/hobit22.github.io/assets/40729223/92c4f18a-e4e9-4a35-9fea-c66d2c646c71)

S2 ì¸ë±ìŠ¤ ìƒì„± í›„ Query Performance Summary
![image](https://github.com/hobit22/hobit22.github.io/assets/40729223/73b48f91-d96e-4123-a7b3-66d7da0b6290)

* excecution time : **421ms -> 3ms**
* examined documents : **80000 -> 465**